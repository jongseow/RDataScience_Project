---
title: "Visualization of  U.S. population mobility changes"
author: Jong-Seo Won
---

# Introduction
Recently, the notion of resilience has attracted attention from many economic geographers who try to understand how regional economies respond to and recover from disturbances. This project attempts to conduct a visualization as a part of study that examines the relationship between population and financial crisis. While regional economic resilience studies investigates how financial crises affect to regional economies, this project ultimately tries to explore how economic downturn affects to population mobility patterns. As a first part of the study of the relationship between population mobility and financial crisis, this project aims to visualize the changing rate of population mobility of 5o states in the United States from 2008 to 2009 when the global financial severely hit U.S.



# Materials and methods 

# Packages

```{r, message=F, warning=F}
library(readr)
library(sp)
library(DT)
library(tigris)
library(ggplot2)
library(plotly)


```


# Data
Population mobility data  (only in-migration data)

Within same county
From different county, same state
From different states
From abroad

```{r}


```



# Methodology

Changing rate of moved population size
= (moved population in 2009) - (moved population in 2008) / (moved population in 2008) * 100

```{r, message=F, warning=F}


## change data type from factor to numeric (2008)
df08<-read.csv("https://raw.githubusercontent.com/jongseow/RDataScience_Project/master/data_project/ACS_08_1YR_S0701_with_ann.csv")
df08<-df08[-c(1,10),]
popValues08<-as.numeric(levels(df08$HC01_EST_VC01))[df08$HC01_EST_VC01]
incounty08<-as.numeric(levels(df08$HC02_EST_VC01))[df08$HC02_EST_VC01]*popValues08
instate08<-as.numeric(levels(df08$HC03_EST_VC01))[df08$HC03_EST_VC01]*popValues08
diffstate08<-as.numeric(levels(df08$HC04_EST_VC01))[df08$HC04_EST_VC01]*popValues08
abroad08<-as.numeric(levels(df08$HC05_EST_VC01))[df08$HC05_EST_VC01]*popValues08


## change data type from factor to numeric (2009)
df09<-read.csv("https://raw.githubusercontent.com/jongseow/RDataScience_Project/master/data_project/ACS_09_1YR_S0701_with_ann.csv")
df09<-df09[-c(1,10),]
popValues09<-as.numeric(levels(df09$HC01_EST_VC01))[df09$HC01_EST_VC01]
incounty09<-as.numeric(levels(df09$HC02_EST_VC01))[df09$HC02_EST_VC01]*popValues09
instate09<-as.numeric(levels(df09$HC03_EST_VC01))[df09$HC03_EST_VC01]*popValues09
diffstate09<-as.numeric(levels(df09$HC04_EST_VC01))[df09$HC04_EST_VC01]*popValues09
abroad09<-as.numeric(levels(df09$HC05_EST_VC01))[df09$HC05_EST_VC01]*popValues09


## change data type from factor to numeric (2010)
df10<-read.csv("https://raw.githubusercontent.com/jongseow/RDataScience_Project/master/data_project/ACS_10_1YR_S0701_with_ann.csv")
df10<-df10[-c(1,10),]
popValues10<-as.numeric(levels(df10$HC01_EST_VC01))[df10$HC01_EST_VC01]
incounty10<-as.numeric(levels(df10$HC02_EST_VC01))[df10$HC02_EST_VC01]*popValues10
instate10<-as.numeric(levels(df10$HC03_EST_VC01))[df10$HC03_EST_VC01]*popValues10
diffstate10<-as.numeric(levels(df10$HC04_EST_VC01))[df10$HC04_EST_VC01]*popValues10
abroad10<-as.numeric(levels(df10$HC05_EST_VC01))[df10$HC05_EST_VC01]*popValues10


```

# Results


```{r}
# creat a new dataframe for Choropleth map  (changing rate 08-09)
df<-data.frame(((popValues09- popValues08)/popValues08)*100, ((incounty09- incounty08)/incounty08)*100, 
               ((instate09- instate08)/instate08)*100, ((diffstate09- diffstate08)/diffstate08)*100, ((abroad09- abroad08)/abroad08)*100)

df.example<-read.csv("https://raw.githubusercontent.com/plotly/datasets/master/2011_us_ag_exports.csv")
df$state<-with(df.example, paste(state))
df$code<-with(df.example, paste(code))
colnames(df)<-c("pop", "incounty", "instate", "diffstate", "abroad", "state", "code")



# Map for populaltion changes in 2008-2009 
df$box <- with(df, paste(state))

g <- list(scope = 'usa',
          projection = list(type = 'albers usa'))

p <- plot_geo(df,locationmode = 'USA-states') %>%
  add_trace(
    z = ~pop,text = ~box, locations = ~code,
    color = ~pop, colors = 'Purples'
  ) %>%
  colorbar(title = "Population Change (percentage)") %>%
  layout(
    title = '2008-09 population changes by State',
    geo = g
  )
p



# Map for population mobility (different counties within same state) changes in 2008-2009
df$box <- with(df, paste(state))

g <- list(scope = 'usa',
          projection = list(type = 'albers usa'))

p <- plot_geo(df,locationmode = 'USA-states') %>%
  add_trace(
    z = ~incounty,text = ~box, locations = ~code,
    color = ~incounty, colors = 'Purples'
  ) %>%
  colorbar(title = "population changes (percentage)") %>%
  layout(
    title = '2008-09 US intra-county moved population changes',
    geo = g
  )
p



# Map for population mobility (from different states) changes in 2008-2009
df$box <- with(df, paste(state))

g <- list(scope = 'usa',
          projection = list(type = 'albers usa'))

p <- plot_geo(df,locationmode = 'USA-states') %>%
  add_trace(
    z = ~instate,text = ~box, locations = ~code,
    color = ~instate, colors = 'Purples'
  ) %>%
  colorbar(title = "population change (percentage)") %>%
  layout(
    title = '2008-09 moved population from different counties within same state',
    geo = g
  )
p



# Map for population mobility (different counties within same state) changes in 2008-2009
df$box <- with(df, paste(state))

g <- list(scope = 'usa',
          projection = list(type = 'albers usa'))

p <- plot_geo(df,locationmode = 'USA-states') %>%
  add_trace(
    z = ~diffstate,text = ~box, locations = ~code,
    color = ~diffstate, colors = 'Purples'
  ) %>%
  colorbar(title = "population changes (percentage)") %>%
  layout(
    title = '2008-09 US inter-state moved population changes',
    geo = g
  )
p



# Map for population mobility (from abroad) changes in 2008-2009 
df$box <- with(df, paste(state))

g <- list(scope = 'usa',
          projection = list(type = 'albers usa'))

p <- plot_geo(df,locationmode = 'USA-states') %>%
  add_trace(
    z = ~abroad,text = ~box, locations = ~code,
    color = ~abroad, colors = 'Purples'
  ) %>%
  colorbar(title = "Moved population size from abroad (percentage)") %>%
  layout(
    title = '2008-09 moved population from abroad',
    geo = g
  )
p

```


```{r}


```


# Conclusions

What have you learned?  Are there any broader implications?


# References
The population mobility data set used in this project was downloaded from the US Census Bureau
U.S. Census Bureau (2008-2010). Geographic Mobility by selected characerustucs in the United States, 2008, 2009, and 2010 American Community Survey 1-year estimates.